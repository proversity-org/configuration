---
# Installation of exporters and Prometheus data gatherer

- name: Bootstrap instances
  hosts: all
  gather_facts: no
  become: true
  roles:
    - python

- hosts: monitored_servers
  become: True
  roles:
    - cloudalchemy.node-exporter
  tags: 
    - install:nodes

- hosts: monitoring_servers
  become: True
  roles:
  - role: nginx
    tags:
      - monitoring_nginx
  - role: pearson_nginx
    PE_NGINX_SITES:
      - grafana
    tags:
      - monitoring_nginx
  - role: cloudalchemy.prometheus
    tags:
      - deploy_prometheus
  - role: cloudalchemy.grafana
    tags:
      - deploy_grafana
